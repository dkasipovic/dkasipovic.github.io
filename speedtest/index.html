<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#3b82f6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SpeedTest">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <title>Speed Test - Kasipovic</title>

  <!-- Leaflet CSS for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- App Styles -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">âš¡ SpeedTest</div>
    <div class="header-actions">
      <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™ Dark</button>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="nav">
    <button class="nav-btn active" data-tab="test">ğŸš€ Speed Test</button>
    <button class="nav-btn" data-tab="history">ğŸ“‹ History</button>
    <button class="nav-btn" data-tab="map">ğŸ—ºï¸ Map</button>
    <button class="nav-btn" data-tab="charts">ğŸ“Š Charts</button>
  </nav>

  <!-- Main Content -->
  <main class="main">
    <!-- Speed Test Tab -->
    <div id="tab-test" class="tab-content active">
      <div class="test-container">
        <div class="test-main">
          <!-- Gauge -->
          <div class="gauge-container">
            <svg class="gauge-svg" viewBox="0 0 200 200">
              <circle class="gauge-bg" cx="100" cy="100" r="90" />
              <circle class="gauge-fill" id="gauge-fill" cx="100" cy="100" r="90" />
            </svg>
            <div class="gauge-center">
              <div class="gauge-value" id="gauge-value">0</div>
              <div class="gauge-unit">Mbps</div>
              <div class="gauge-label" id="gauge-label">Ready</div>
            </div>
          </div>

          <!-- Test Status -->
          <div class="test-status">
            <div class="status-item">
              <div class="status-icon" id="status-latency">ğŸ“¶</div>
              <div class="status-label">Latency</div>
              <div class="status-value" id="value-latency">--</div>
            </div>
            <div class="status-item">
              <div class="status-icon" id="status-download">â¬‡ï¸</div>
              <div class="status-label">Download</div>
              <div class="status-value" id="value-download">--</div>
            </div>
            <div class="status-item">
              <div class="status-icon" id="status-upload">â¬†ï¸</div>
              <div class="status-label">Upload</div>
              <div class="status-value" id="value-upload">--</div>
            </div>
            <div class="status-item">
              <div class="status-icon" id="status-jitter">ğŸ“Š</div>
              <div class="status-label">Jitter</div>
              <div class="status-value" id="value-jitter">--</div>
            </div>
          </div>

          <!-- Start Button -->
          <button class="start-btn" id="start-btn" onclick="toggleTest()">Start Test</button>

          <!-- Results Grid (shown after test) -->
          <div class="results-grid" id="results-grid" style="display: none;">
            <div class="result-card">
              <div class="result-icon">â¬‡ï¸</div>
              <div class="result-value" id="result-download">0</div>
              <div class="result-unit">Mbps</div>
              <div class="result-label">Download</div>
            </div>
            <div class="result-card">
              <div class="result-icon">â¬†ï¸</div>
              <div class="result-value" id="result-upload">0</div>
              <div class="result-unit">Mbps</div>
              <div class="result-label">Upload</div>
            </div>
            <div class="result-card">
              <div class="result-icon">ğŸ“¶</div>
              <div class="result-value" id="result-latency">0</div>
              <div class="result-unit">ms</div>
              <div class="result-label">Latency</div>
            </div>
            <div class="result-card">
              <div class="result-icon">ğŸ“Š</div>
              <div class="result-value" id="result-jitter">0</div>
              <div class="result-unit">ms</div>
              <div class="result-label">Jitter</div>
            </div>
          </div>
        </div>

        <!-- Device Info Panel -->
        <aside class="device-panel">
          <h3 class="panel-title">ğŸ“± Device & Network Info</h3>

          <div class="info-section">
            <div class="info-section-title">Device</div>
            <div class="info-row">
              <span class="info-label">Type</span>
              <span class="info-value" id="info-device-type">Detecting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Brand</span>
              <span class="info-value" id="info-device-brand">Detecting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Model</span>
              <span class="info-value" id="info-device-model">Detecting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">OS</span>
              <span class="info-value" id="info-os">Detecting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Browser</span>
              <span class="info-value" id="info-browser">Detecting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Screen</span>
              <span class="info-value" id="info-screen">Detecting...</span>
            </div>
          </div>

          <div class="info-section">
            <div class="info-section-title">Network</div>
            <div class="info-row">
              <span class="info-label">External IP</span>
              <span class="info-value loading" id="info-external-ip">Fetching...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Internal IP</span>
              <span class="info-value loading" id="info-internal-ip">Detecting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Connection</span>
              <span class="info-value" id="info-connection">Detecting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Effective Type</span>
              <span class="info-value" id="info-effective-type">Detecting...</span>
            </div>
          </div>

          <div class="info-section">
            <div class="info-section-title">Location</div>
            <div class="info-row">
              <span class="info-label">Latitude</span>
              <span class="info-value loading" id="info-lat">Requesting...</span>
            </div>
            <div class="info-row">
              <span class="info-label">Longitude</span>
              <span class="info-value loading" id="info-lng">Requesting...</span>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- History Tab -->
    <div id="tab-history" class="tab-content">
      <div class="history-header">
        <h2 class="history-title">Test History</h2>
        <div class="history-actions">
          <button class="btn" onclick="exportHistory()">ğŸ“¥ Export</button>
          <button class="btn" onclick="importHistory()">ğŸ“¤ Import</button>
          <button class="btn danger" onclick="clearHistory()">ğŸ—‘ï¸ Clear All</button>
        </div>
      </div>

      <div class="history-table-container">
        <table class="history-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Date</th>
              <th>Download</th>
              <th>Upload</th>
              <th>Latency</th>
              <th>Device</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="history-tbody">
          </tbody>
        </table>
        <div class="empty-state" id="history-empty">
          <div class="empty-state-icon">ğŸ“‹</div>
          <p>No test history yet. Run a speed test to get started!</p>
        </div>
      </div>
    </div>

    <!-- Map Tab -->
    <div id="tab-map" class="tab-content">
      <div class="history-header">
        <h2 class="history-title">Test Locations</h2>
      </div>
      <div class="map-container">
        <div id="history-map"></div>
      </div>
    </div>

    <!-- Charts Tab -->
    <div id="tab-charts" class="tab-content">
      <div class="history-header">
        <h2 class="history-title">Speed Trends</h2>
      </div>
      <div class="chart-container">
        <canvas id="speed-chart" class="chart-canvas"></canvas>
      </div>
    </div>
  </main>

  <!-- Save Modal -->
  <div class="modal-overlay" id="save-modal">
    <div class="modal">
      <h3 class="modal-title">Save Test Result</h3>
      <input type="text" class="modal-input" id="test-name-input" placeholder="Enter a name for this test...">
      <div class="modal-actions">
        <button class="modal-btn secondary" onclick="closeSaveModal()">Cancel</button>
        <button class="modal-btn primary" onclick="saveTestResult()">Save</button>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal-overlay" id="edit-modal">
    <div class="modal">
      <h3 class="modal-title">Rename Test</h3>
      <input type="text" class="modal-input" id="edit-name-input" placeholder="Enter new name...">
      <div class="modal-actions">
        <button class="modal-btn secondary" onclick="closeEditModal()">Cancel</button>
        <button class="modal-btn primary" onclick="updateTestName()">Save</button>
      </div>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal-overlay" id="detail-modal">
    <div class="modal" style="max-width: 600px;">
      <h3 class="modal-title" id="detail-title">Test Details</h3>
      <div id="detail-content"></div>
      <div class="modal-actions" style="margin-top: 1.5rem;">
        <button class="modal-btn secondary" onclick="closeDetailModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Hidden file input for import -->
  <input type="file" id="import-input" accept=".json" style="display: none;">

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Cloudflare Speedtest -->
  <script type="module">
    import SpeedTest from 'https://esm.sh/@cloudflare/speedtest@1.7.0';
    window.SpeedTest = SpeedTest;
  </script>

  <!-- App Script -->
  <script src="script.js"></script>
</body>

</html>